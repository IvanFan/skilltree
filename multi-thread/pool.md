**用线程池就一定更快吗**

  


这真的不一定，这让我想起了Redis，Redis也是单线程的，但是它却非常的高效，当然Redis用单线程速度快原因是，它都是基于内存的操作，这种情况下能高效的利用CPU，而多线程适用于有一定比例IO和网络操作的场景。很多时间，IO才是一个瓶颈，即使再过的CPU内核，也无法逾越IO这个瓶颈。

这同样让我想起了，tomcat使用IO和NIO，在性能测试时，并没有什么明显的差距，同样是因为tomcat后端通常都是很重的IO操作，无论如何，都要有等待时间。所以我们在评估线程池大小时应该考虑到网络IO。线程等待时间所占比例越高，需要越多线程；线程CPU时间所占比例越高，需要越少线程。

  


**如何设置线程池？**

  


1、我通常会将核心线程数和最大线程数，设置为一样的，避免线程的频繁创建和销毁带来的损耗。

2、如果是CPU密集型的计算，设置为和CPU的数量一致，如果是IO密集的计算，最少为CPU数量的两倍

3、可以参考科特尔法则：一个系统请求数等于请求的到达率与平均每个单独请求花费的时间之乘积。如果每秒请求数为10次，每个请求处理时间为1秒，那么在任何时刻都有10个请求正在被处理，就需要使用10个线程来进行处理，如果请求数翻倍，就是20个。但这只是一个理想情况。

  


